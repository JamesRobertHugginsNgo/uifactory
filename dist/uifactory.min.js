"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}function stringToHtml(e){var t=document.createElement("div");return t.innerHTML=e,_toConsumableArray(t.childNodes).map(function(e){return e instanceof HTMLElement?uiFactory(e):e})}var uiFactoryPropertyDescriptors={definedByUiFactoryPropertyDescriptors:{value:!0},uiFactoryAttributes:{writable:!0},uiFactoryChildElements:{writable:!0},render:{value:function(e,t){var a=this,c=!(1<arguments.length&&void 0!==t)||t;return Promise.all([function r(n,t,o){if(null!=n)return n instanceof Promise?n.then(function(e){return r(e,t,o)}):"function"==typeof n?r(n(a),t,o):Array.isArray(n)?Promise.all(n.map(function(e,t){return r(e,t,n)})):"object"===_typeof(n)?Promise.all(Object.keys(n).map(function(e){return a.removeAttribute(e),r(n[e],e,n)})):void(t&&("function"!=typeof o[t]&&delete o[t],a.setAttribute(t,n)))}(this.uiFactoryAttributes),function(e){for(;a.firstChild;)a.removeChild(a.firstChild);return function r(n,o,t,i){if(o=o||a.appendChild(document.createTextNode("")),null!=n){if(n instanceof Promise)return n.then(function(e){return r(e,o,t,i)});if("function"==typeof n)return r(n(a),o,t,i);if(Array.isArray(n)){var e=Promise.all(n.map(function(e,t){return r(e,a.insertBefore(document.createTextNode(""),o),n,t)}));return a.removeChild(o),e}if(n instanceof HTMLElement||n instanceof Text)return a.insertBefore(n,o),a.removeChild(o),c&&n.definedByUiFactoryPropertyDescriptors?new Promise(function(e){n.render(e)}):void 0;if("object"!==_typeof(n))return"boolean"==typeof n||"number"==typeof n||"string"==typeof n?(n=stringToHtml(n),t&&i&&"function"!=typeof t[i]&&(t[i]=n),r(n,o,t,i)):void 0;var u=Promise.all(Object.keys(n).map(function(e){return r(n[e],a.insertBefore(document.createTextNode(""),o),n,e)}));return a.removeChild(o),u}a.removeChild(o)}(e)}(this.uiFactoryChildElements)]).then(function(){e&&e(a)}),this}}};function uiFactory(e,t,r,n){"string"==typeof e&&(e=document.createElement(e)),e.definedByUiFactoryPropertyDescriptors||Object.defineProperties(e,uiFactoryPropertyDescriptors),e.uiFactoryAttributes=t,e.uiFactoryChildElements=r;var o,i=_toConsumableArray(e.childNodes).map(function(e){return e instanceof HTMLElement?uiFactory(e):e});0<i.length&&(e.uiFactoryChildElements=e.uiFactoryChildElements?Array.isArray(e.uiFactoryChildElements)?e.uiFactoryChildElements:[e.uiFactoryChildElements]:[],(o=e.uiFactoryChildElements).unshift.apply(o,_toConsumableArray(i)));return e.render(n,!1)}
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInVpZmFjdG9yeS5qcyJdLCJuYW1lcyI6WyJfdHlwZW9mIiwib2JqIiwiU3ltYm9sIiwiaXRlcmF0b3IiLCJjb25zdHJ1Y3RvciIsInByb3RvdHlwZSIsIl90b0NvbnN1bWFibGVBcnJheSIsImFyciIsIl9hcnJheVdpdGhvdXRIb2xlcyIsIl9pdGVyYWJsZVRvQXJyYXkiLCJfbm9uSXRlcmFibGVTcHJlYWQiLCJUeXBlRXJyb3IiLCJpdGVyIiwiT2JqZWN0IiwidG9TdHJpbmciLCJjYWxsIiwiQXJyYXkiLCJmcm9tIiwiaXNBcnJheSIsImkiLCJhcnIyIiwibGVuZ3RoIiwic3RyaW5nVG9IdG1sIiwic3RyIiwiZWxlbWVudCIsImRvY3VtZW50IiwiY3JlYXRlRWxlbWVudCIsImlubmVySFRNTCIsImNoaWxkTm9kZXMiLCJtYXAiLCJIVE1MRWxlbWVudCIsInVpRmFjdG9yeSIsInVpRmFjdG9yeVByb3BlcnR5RGVzY3JpcHRvcnMiLCJkZWZpbmVkQnlVaUZhY3RvcnlQcm9wZXJ0eURlc2NyaXB0b3JzIiwidmFsdWUiLCJ1aUZhY3RvcnlBdHRyaWJ1dGVzIiwid3JpdGFibGUiLCJ1aUZhY3RvcnlDaGlsZEVsZW1lbnRzIiwicmVuZGVyIiwiY2FsbGJhY2siLCJfdGhpcyIsInRoaXMiLCJjaGFpblJlbmRlciIsImFyZ3VtZW50cyIsInVuZGVmaW5lZCIsIlByb21pc2UiLCJhbGwiLCJyZW5kZXJBdHRyaWJ1dGVzIiwiYXR0cmlidXRlcyIsImtleSIsInNvdXJjZSIsInRoZW4iLCJhdHRyaWJ1dGUiLCJpbmRleCIsImtleXMiLCJyZW1vdmVBdHRyaWJ1dGUiLCJzZXRBdHRyaWJ1dGUiLCJjaGlsZEVsZW1lbnRzIiwiZmlyc3RDaGlsZCIsInJlbW92ZUNoaWxkIiwicmVuZGVyQ2hpbGRFbGVtZW50cyIsInBsYWNlaG9sZGVyIiwiYXBwZW5kQ2hpbGQiLCJjcmVhdGVUZXh0Tm9kZSIsInJldHVyblZhbHVlIiwiY2hpbGRFbGVtZW50IiwiaW5zZXJ0QmVmb3JlIiwiVGV4dCIsInJlc29sdmUiLCJfcmV0dXJuVmFsdWUiLCJwcmVuZGVyQ2hpbGRFbGVtZW50cyIsImRlZmluZVByb3BlcnRpZXMiLCJfZWxlbWVudCR1aUZhY3RvcnlDaGkiLCJvcmlnaW5hbENoaWxkRWxlbWVudHMiLCJjaGlsZE5vZGUiLCJ1bnNoaWZ0IiwiYXBwbHkiXSwibWFwcGluZ3MiOiJBQUFBLGFBRUEsU0FBU0EsUUFBUUMsR0FBd1QsT0FBdE9ELFFBQXJELG1CQUFYRSxRQUFvRCxpQkFBcEJBLE9BQU9DLFNBQW1DLFNBQWlCRixHQUFPLGNBQWNBLEdBQTJCLFNBQWlCQSxHQUFPLE9BQU9BLEdBQXlCLG1CQUFYQyxRQUF5QkQsRUFBSUcsY0FBZ0JGLFFBQVVELElBQVFDLE9BQU9HLFVBQVksZ0JBQWtCSixJQUF5QkEsR0FFeFYsU0FBU0ssbUJBQW1CQyxHQUFPLE9BQU9DLG1CQUFtQkQsSUFBUUUsaUJBQWlCRixJQUFRRyxxQkFFOUYsU0FBU0EscUJBQXVCLE1BQU0sSUFBSUMsVUFBVSxtREFFcEQsU0FBU0YsaUJBQWlCRyxHQUFRLEdBQUlWLE9BQU9DLFlBQVlVLE9BQU9ELElBQWtELHVCQUF6Q0MsT0FBT1IsVUFBVVMsU0FBU0MsS0FBS0gsR0FBZ0MsT0FBT0ksTUFBTUMsS0FBS0wsR0FFMUosU0FBU0osbUJBQW1CRCxHQUFPLEdBQUlTLE1BQU1FLFFBQVFYLEdBQU0sQ0FBRSxJQUFLLElBQUlZLEVBQUksRUFBR0MsRUFBTyxJQUFJSixNQUFNVCxFQUFJYyxRQUFTRixFQUFJWixFQUFJYyxPQUFRRixJQUFPQyxFQUFLRCxHQUFLWixFQUFJWSxHQUFNLE9BQU9DLEdBUzdKLFNBQVNFLGFBQWFDLEdBQ3BCLElBQUlDLEVBQVVDLFNBQVNDLGNBQWMsT0FFckMsT0FEQUYsRUFBUUcsVUFBWUosRUFDYmpCLG1CQUFtQmtCLEVBQVFJLFlBQVlDLElBQUksU0FBVUwsR0FDMUQsT0FBSUEsYUFBbUJNLFlBQ2RDLFVBQVVQLEdBR1pBLElBTVgsSUFBSVEsNkJBQStCLENBQ2pDQyxzQ0FBdUMsQ0FDckND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LEVBQWVsQixHQUU5QixpQkFBWmYsSUFDVEEsRUFBVUMsU0FBU0MsY0FBY0YsSUFJOUJBLEVBQVFTLHVDQUNYcEIsT0FBTzBELGlCQUFpQi9DLEVBQVNRLDhCQUluQ1IsRUFBUVcsb0JBQXNCYSxFQUM5QnhCLEVBQVFhLHVCQUF5Qm9CLEVBRWpDLElBS01lLEVBTEZDLEVBQXdCbkUsbUJBQW1Ca0IsRUFBUUksWUFBWUMsSUFBSSxTQUFVNkMsR0FDL0UsT0FBT0EsYUFBcUI1QyxZQUFjQyxVQUFVMkMsR0FBYUEsSUFHaEMsRUFBL0JELEVBQXNCcEQsU0FHeEJHLEVBQVFhLHVCQUF5QmIsRUFBUWEsdUJBQXlCckIsTUFBTUUsUUFBUU0sRUFBUWEsd0JBQTBCYixFQUFRYSx1QkFBeUIsQ0FBQ2IsRUFBUWEsd0JBQTBCLElBRXJMbUMsRUFBd0JoRCxFQUFRYSx3QkFBd0JzQyxRQUFRQyxNQUFNSixFQUF1QmxFLG1CQUFtQm1FLEtBSW5ILE9BQU9qRCxFQUFRYyxPQUFPQyxHQUFVIiwiZmlsZSI6InVpZmFjdG9yeS5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcblxuZnVuY3Rpb24gX3R5cGVvZihvYmopIHsgaWYgKHR5cGVvZiBTeW1ib2wgPT09IFwiZnVuY3Rpb25cIiAmJiB0eXBlb2YgU3ltYm9sLml0ZXJhdG9yID09PSBcInN5bWJvbFwiKSB7IF90eXBlb2YgPSBmdW5jdGlvbiBfdHlwZW9mKG9iaikgeyByZXR1cm4gdHlwZW9mIG9iajsgfTsgfSBlbHNlIHsgX3R5cGVvZiA9IGZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7IHJldHVybiBvYmogJiYgdHlwZW9mIFN5bWJvbCA9PT0gXCJmdW5jdGlvblwiICYmIG9iai5jb25zdHJ1Y3RvciA9PT0gU3ltYm9sICYmIG9iaiAhPT0gU3ltYm9sLnByb3RvdHlwZSA/IFwic3ltYm9sXCIgOiB0eXBlb2Ygb2JqOyB9OyB9IHJldHVybiBfdHlwZW9mKG9iaik7IH1cblxuZnVuY3Rpb24gX3RvQ29uc3VtYWJsZUFycmF5KGFycikgeyByZXR1cm4gX2FycmF5V2l0aG91dEhvbGVzKGFycikgfHwgX2l0ZXJhYmxlVG9BcnJheShhcnIpIHx8IF9ub25JdGVyYWJsZVNwcmVhZCgpOyB9XG5cbmZ1bmN0aW9uIF9ub25JdGVyYWJsZVNwcmVhZCgpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkludmFsaWQgYXR0ZW1wdCB0byBzcHJlYWQgbm9uLWl0ZXJhYmxlIGluc3RhbmNlXCIpOyB9XG5cbmZ1bmN0aW9uIF9pdGVyYWJsZVRvQXJyYXkoaXRlcikgeyBpZiAoU3ltYm9sLml0ZXJhdG9yIGluIE9iamVjdChpdGVyKSB8fCBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoaXRlcikgPT09IFwiW29iamVjdCBBcmd1bWVudHNdXCIpIHJldHVybiBBcnJheS5mcm9tKGl0ZXIpOyB9XG5cbmZ1bmN0aW9uIF9hcnJheVdpdGhvdXRIb2xlcyhhcnIpIHsgaWYgKEFycmF5LmlzQXJyYXkoYXJyKSkgeyBmb3IgKHZhciBpID0gMCwgYXJyMiA9IG5ldyBBcnJheShhcnIubGVuZ3RoKTsgaSA8IGFyci5sZW5ndGg7IGkrKykgeyBhcnIyW2ldID0gYXJyW2ldOyB9IHJldHVybiBhcnIyOyB9IH1cblxuLyogZXhwb3J0ZWQgc3RyaW5nVG9IdG1sICovXG5cbi8qKlxuICogQ3JlYXRlIGNoaWxkIGVsZW1lbnRzIGZvciB1aUZhY3RvcnkuXG4gKiBAcGFyYW0ge3N0cmluZ30gc3RyXG4gKiBAcmV0dXJucyB7W0hUTUxFbGVtZW50fFRleHRdfVxuICovXG5mdW5jdGlvbiBzdHJpbmdUb0h0bWwoc3RyKSB7XG4gIHZhciBlbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gIGVsZW1lbnQuaW5uZXJIVE1MID0gc3RyO1xuICByZXR1cm4gX3RvQ29uc3VtYWJsZUFycmF5KGVsZW1lbnQuY2hpbGROb2RlcykubWFwKGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgaWYgKGVsZW1lbnQgaW5zdGFuY2VvZiBIVE1MRWxlbWVudCkge1xuICAgICAgcmV0dXJuIHVpRmFjdG9yeShlbGVtZW50KTtcbiAgICB9XG5cbiAgICByZXR1cm4gZWxlbWVudDtcbiAgfSk7XG59XG4vKiogT2JqZWN0IGRlc2NyaXB0b3JzIHRvIGJlIHVzZWQgb24gSFRNTEVsZW1lbnRzLiAqL1xuXG5cbnZhciB1aUZhY3RvcnlQcm9wZXJ0eURlc2NyaXB0b3JzID0ge1xuICBkZWZpbmVkQnlVaUZhY3RvcnlQcm9wZXJ0eURlc2NyaXB0b3JzOiB7XG4gICAgdmFsdWU6IHRydWVcbiAgfSxcbiAgdWlGYWN0b3J5QXR0cmlidXRlczoge1xuICAgIHdyaXRhYmxlOiB0cnVlXG4gIH0sXG4gIHVpRmFjdG9yeUNoaWxkRWxlbWVudHM6IHtcbiAgICB3cml0YWJsZTogdHJ1ZVxuICB9LFxuICByZW5kZXI6IHtcbiAgICB2YWx1ZTogZnVuY3Rpb24gdmFsdWUoY2FsbGJhY2spIHtcbiAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG5cbiAgICAgIHZhciBjaGFpblJlbmRlciA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogdHJ1ZTtcblxuICAgICAgdmFyIHJlbmRlckF0dHJpYnV0ZXMgPSBmdW5jdGlvbiByZW5kZXJBdHRyaWJ1dGVzKGF0dHJpYnV0ZXMsIGtleSwgc291cmNlKSB7XG4gICAgICAgIGlmIChhdHRyaWJ1dGVzID09IG51bGwpIHtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoYXR0cmlidXRlcyBpbnN0YW5jZW9mIFByb21pc2UpIHtcbiAgICAgICAgICByZXR1cm4gYXR0cmlidXRlcy50aGVuKGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICAgICAgcmV0dXJuIHJlbmRlckF0dHJpYnV0ZXModmFsdWUsIGtleSwgc291cmNlKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0eXBlb2YgYXR0cmlidXRlcyA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgIHJldHVybiByZW5kZXJBdHRyaWJ1dGVzKGF0dHJpYnV0ZXMoX3RoaXMpLCBrZXksIHNvdXJjZSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShhdHRyaWJ1dGVzKSkge1xuICAgICAgICAgIHJldHVybiBQcm9taXNlLmFsbChhdHRyaWJ1dGVzLm1hcChmdW5jdGlvbiAoYXR0cmlidXRlLCBpbmRleCkge1xuICAgICAgICAgICAgcmV0dXJuIHJlbmRlckF0dHJpYnV0ZXMoYXR0cmlidXRlLCBpbmRleCwgYXR0cmlidXRlcyk7XG4gICAgICAgICAgfSkpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKF90eXBlb2YoYXR0cmlidXRlcykgPT09ICdvYmplY3QnKSB7XG4gICAgICAgICAgcmV0dXJuIFByb21pc2UuYWxsKE9iamVjdC5rZXlzKGF0dHJpYnV0ZXMpLm1hcChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgICAgICBfdGhpcy5yZW1vdmVBdHRyaWJ1dGUoa2V5KTtcblxuICAgICAgICAgICAgcmV0dXJuIHJlbmRlckF0dHJpYnV0ZXMoYXR0cmlidXRlc1trZXldLCBrZXksIGF0dHJpYnV0ZXMpO1xuICAgICAgICAgIH0pKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChrZXkpIHtcbiAgICAgICAgICBpZiAodHlwZW9mIHNvdXJjZVtrZXldICE9PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICBkZWxldGUgc291cmNlW2tleV07XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgX3RoaXMuc2V0QXR0cmlidXRlKGtleSwgYXR0cmlidXRlcyk7XG4gICAgICAgIH1cbiAgICAgIH07XG5cbiAgICAgIHZhciByZW5kZXJDaGlsZEVsZW1lbnRzID0gZnVuY3Rpb24gcmVuZGVyQ2hpbGRFbGVtZW50cyhjaGlsZEVsZW1lbnRzLCBwbGFjZWhvbGRlciwgc291cmNlLCBrZXkpIHtcbiAgICAgICAgcGxhY2Vob2xkZXIgPSBwbGFjZWhvbGRlciB8fCBfdGhpcy5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnJykpO1xuXG4gICAgICAgIGlmIChjaGlsZEVsZW1lbnRzID09IG51bGwpIHtcbiAgICAgICAgICBfdGhpcy5yZW1vdmVDaGlsZChwbGFjZWhvbGRlcik7XG5cbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoY2hpbGRFbGVtZW50cyBpbnN0YW5jZW9mIFByb21pc2UpIHtcbiAgICAgICAgICByZXR1cm4gY2hpbGRFbGVtZW50cy50aGVuKGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICAgICAgcmV0dXJuIHJlbmRlckNoaWxkRWxlbWVudHModmFsdWUsIHBsYWNlaG9sZGVyLCBzb3VyY2UsIGtleSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodHlwZW9mIGNoaWxkRWxlbWVudHMgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICByZXR1cm4gcmVuZGVyQ2hpbGRFbGVtZW50cyhjaGlsZEVsZW1lbnRzKF90aGlzKSwgcGxhY2Vob2xkZXIsIHNvdXJjZSwga2V5KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChBcnJheS5pc0FycmF5KGNoaWxkRWxlbWVudHMpKSB7XG4gICAgICAgICAgdmFyIHJldHVyblZhbHVlID0gUHJvbWlzZS5hbGwoY2hpbGRFbGVtZW50cy5tYXAoZnVuY3Rpb24gKGNoaWxkRWxlbWVudCwgaW5kZXgpIHtcbiAgICAgICAgICAgIHJldHVybiByZW5kZXJDaGlsZEVsZW1lbnRzKGNoaWxkRWxlbWVudCwgX3RoaXMuaW5zZXJ0QmVmb3JlKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKCcnKSwgcGxhY2Vob2xkZXIpLCBjaGlsZEVsZW1lbnRzLCBpbmRleCk7XG4gICAgICAgICAgfSkpO1xuXG4gICAgICAgICAgX3RoaXMucmVtb3ZlQ2hpbGQocGxhY2Vob2xkZXIpO1xuXG4gICAgICAgICAgcmV0dXJuIHJldHVyblZhbHVlO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGNoaWxkRWxlbWVudHMgaW5zdGFuY2VvZiBIVE1MRWxlbWVudCB8fCBjaGlsZEVsZW1lbnRzIGluc3RhbmNlb2YgVGV4dCkge1xuICAgICAgICAgIF90aGlzLmluc2VydEJlZm9yZShjaGlsZEVsZW1lbnRzLCBwbGFjZWhvbGRlcik7XG5cbiAgICAgICAgICBfdGhpcy5yZW1vdmVDaGlsZChwbGFjZWhvbGRlcik7XG5cbiAgICAgICAgICBpZiAoY2hhaW5SZW5kZXIgJiYgY2hpbGRFbGVtZW50cy5kZWZpbmVkQnlVaUZhY3RvcnlQcm9wZXJ0eURlc2NyaXB0b3JzKSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUpIHtcbiAgICAgICAgICAgICAgY2hpbGRFbGVtZW50cy5yZW5kZXIocmVzb2x2ZSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChfdHlwZW9mKGNoaWxkRWxlbWVudHMpID09PSAnb2JqZWN0Jykge1xuICAgICAgICAgIHZhciBfcmV0dXJuVmFsdWUgPSBQcm9taXNlLmFsbChPYmplY3Qua2V5cyhjaGlsZEVsZW1lbnRzKS5tYXAoZnVuY3Rpb24gKGtleSkge1xuICAgICAgICAgICAgcmV0dXJuIHJlbmRlckNoaWxkRWxlbWVudHMoY2hpbGRFbGVtZW50c1trZXldLCBfdGhpcy5pbnNlcnRCZWZvcmUoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJycpLCBwbGFjZWhvbGRlciksIGNoaWxkRWxlbWVudHMsIGtleSk7XG4gICAgICAgICAgfSkpO1xuXG4gICAgICAgICAgX3RoaXMucmVtb3ZlQ2hpbGQocGxhY2Vob2xkZXIpO1xuXG4gICAgICAgICAgcmV0dXJuIF9yZXR1cm5WYWx1ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0eXBlb2YgY2hpbGRFbGVtZW50cyA9PT0gJ2Jvb2xlYW4nIHx8IHR5cGVvZiBjaGlsZEVsZW1lbnRzID09PSAnbnVtYmVyJyB8fCB0eXBlb2YgY2hpbGRFbGVtZW50cyA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICBjaGlsZEVsZW1lbnRzID0gc3RyaW5nVG9IdG1sKGNoaWxkRWxlbWVudHMpO1xuXG4gICAgICAgICAgaWYgKHNvdXJjZSAmJiBrZXkgJiYgdHlwZW9mIHNvdXJjZVtrZXldICE9PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICBzb3VyY2Vba2V5XSA9IGNoaWxkRWxlbWVudHM7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgcmV0dXJuIHJlbmRlckNoaWxkRWxlbWVudHMoY2hpbGRFbGVtZW50cywgcGxhY2Vob2xkZXIsIHNvdXJjZSwga2V5KTtcbiAgICAgICAgfVxuICAgICAgfTtcblxuICAgICAgdmFyIHByZW5kZXJDaGlsZEVsZW1lbnRzID0gZnVuY3Rpb24gcHJlbmRlckNoaWxkRWxlbWVudHMoY2hpbGRFbGVtZW50cykge1xuICAgICAgICB3aGlsZSAoX3RoaXMuZmlyc3RDaGlsZCkge1xuICAgICAgICAgIF90aGlzLnJlbW92ZUNoaWxkKF90aGlzLmZpcnN0Q2hpbGQpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHJlbmRlckNoaWxkRWxlbWVudHMoY2hpbGRFbGVtZW50cyk7XG4gICAgICB9O1xuXG4gICAgICBQcm9taXNlLmFsbChbcmVuZGVyQXR0cmlidXRlcyh0aGlzLnVpRmFjdG9yeUF0dHJpYnV0ZXMpLCBwcmVuZGVyQ2hpbGRFbGVtZW50cyh0aGlzLnVpRmFjdG9yeUNoaWxkRWxlbWVudHMpXSkudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmIChjYWxsYmFjaykge1xuICAgICAgICAgIGNhbGxiYWNrKF90aGlzKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9XG4gIH1cbn07XG4vKiBleHBvcnRlZCB1aUZhY3RvcnkgKi9cblxuLyoqXG4gKiB1aUZhY3RvcnkgZmFjdG9yeS5cbiAqIEBwYXJhbSB7c3RyaW5nfEhUTUxFbGVtZW50fSBlbGVtZW50XG4gKiBAcGFyYW0ge29iamVjdHxbb2JqZWN0XX0gYXR0cmlidXRlc1xuICogQHBhcmFtIHtIVE1MRWxlbWVudHxmdW5jdGlvbnxzdHJpbmd8VGV4dHxvYmplY3R8W0hUTUxFbGVtZW50fGZ1bmN0aW9ufHN0cmluZ3xUZXh0fG9iamVjdF19IGNoaWxkRWxlbWVudHNcbiAqIEBwYXJhbSB7ZnVuY3Rpb259IGNhbGxiYWNrXG4gKiBAcmV0dXJucyB7SFRNTEVsZW1lbnR9XG4gKi9cblxuZnVuY3Rpb24gdWlGYWN0b3J5KGVsZW1lbnQsIGF0dHJpYnV0ZXMsIGNoaWxkRWxlbWVudHMsIGNhbGxiYWNrKSB7XG4gIC8vIFBhc3MgZWxlbWVudCBuYW1lIGFzIHN0cmluZyB0byBjcmVhdGUgYSBuZXcgZWxlbWVudC5cbiAgaWYgKHR5cGVvZiBlbGVtZW50ID09PSAnc3RyaW5nJykge1xuICAgIGVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KGVsZW1lbnQpO1xuICB9IC8vIEFkZCBlc3NlbnRpYWwgcHJvcGVydGllcyBhbmQgbWV0aG9kLlxuXG5cbiAgaWYgKCFlbGVtZW50LmRlZmluZWRCeVVpRmFjdG9yeVByb3BlcnR5RGVzY3JpcHRvcnMpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydGllcyhlbGVtZW50LCB1aUZhY3RvcnlQcm9wZXJ0eURlc2NyaXB0b3JzKTtcbiAgfSAvLyBBZGQgdmFsdWVzIHRvIGVzc2VudGlhbCBwcm9wZXJ0aWVzLlxuXG5cbiAgZWxlbWVudC51aUZhY3RvcnlBdHRyaWJ1dGVzID0gYXR0cmlidXRlcztcbiAgZWxlbWVudC51aUZhY3RvcnlDaGlsZEVsZW1lbnRzID0gY2hpbGRFbGVtZW50czsgLy8gUHJlcGVuZCBleGlzdGluZyBjaGlsZCBlbGVtZW50cyB0byBwcm9wZXJ0eSwgb3RoZXJ3aXNlIGl0IHdpbGwgYmUgcmVtb3ZlZCBvbiB0aGUgbmV4dCByZW5kZXIuXG5cbiAgdmFyIG9yaWdpbmFsQ2hpbGRFbGVtZW50cyA9IF90b0NvbnN1bWFibGVBcnJheShlbGVtZW50LmNoaWxkTm9kZXMpLm1hcChmdW5jdGlvbiAoY2hpbGROb2RlKSB7XG4gICAgcmV0dXJuIGNoaWxkTm9kZSBpbnN0YW5jZW9mIEhUTUxFbGVtZW50ID8gdWlGYWN0b3J5KGNoaWxkTm9kZSkgOiBjaGlsZE5vZGU7XG4gIH0pO1xuXG4gIGlmIChvcmlnaW5hbENoaWxkRWxlbWVudHMubGVuZ3RoID4gMCkge1xuICAgIHZhciBfZWxlbWVudCR1aUZhY3RvcnlDaGk7XG5cbiAgICBlbGVtZW50LnVpRmFjdG9yeUNoaWxkRWxlbWVudHMgPSBlbGVtZW50LnVpRmFjdG9yeUNoaWxkRWxlbWVudHMgPyBBcnJheS5pc0FycmF5KGVsZW1lbnQudWlGYWN0b3J5Q2hpbGRFbGVtZW50cykgPyBlbGVtZW50LnVpRmFjdG9yeUNoaWxkRWxlbWVudHMgOiBbZWxlbWVudC51aUZhY3RvcnlDaGlsZEVsZW1lbnRzXSA6IFtdO1xuXG4gICAgKF9lbGVtZW50JHVpRmFjdG9yeUNoaSA9IGVsZW1lbnQudWlGYWN0b3J5Q2hpbGRFbGVtZW50cykudW5zaGlmdC5hcHBseShfZWxlbWVudCR1aUZhY3RvcnlDaGksIF90b0NvbnN1bWFibGVBcnJheShvcmlnaW5hbENoaWxkRWxlbWVudHMpKTtcbiAgfSAvLyBUcmlnZ2VyIHJlbmRlciBmb3IgdGhpcyBlbGVtZW50IG9ubHkuXG5cblxuICByZXR1cm4gZWxlbWVudC5yZW5kZXIoY2FsbGJhY2ssIGZhbHNlKTtcbn0iXX0=
